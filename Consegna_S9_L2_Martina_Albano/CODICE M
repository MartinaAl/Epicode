let
    Origine = Excel.Workbook(File.Contents("C:\Users\Francesco Maurella\Downloads\M3S1E2.xlsx"), null, true),
    Ordini_Sheet = Origine{[Item="Ordini",Kind="Sheet"]}[Data],
    #"Intestazioni alzate di livello" = Table.PromoteHeaders(Ordini_Sheet, [PromoteAllScalars=true]),
    #"Modificato tipo" = Table.TransformColumnTypes(#"Intestazioni alzate di livello",{{"dqwdqw", type text}, {"Column2", type any}, {"Column3", type any}, {"Column4", type text}, {"Column5", type text}, {"Column6", type any}, {"Column7", type text}, {"Column8", type text}, {"Column9", type any}, {"Column10", type any}, {"Column11", type any}}),
    #"Rimosse prime righe" = Table.Skip(#"Modificato tipo",2),
    #"Intestazioni alzate di livello1" = Table.PromoteHeaders(#"Rimosse prime righe", [PromoteAllScalars=true]),
    #"Modificato tipo1" = Table.TransformColumnTypes(#"Intestazioni alzate di livello1",{{"COD PROD", type text}, {"Column2", type any}, {"Column3", type any}, {"Collaboratore", type text}, {"Regione", type text}, {"Column6", type date}, {"Categoria", type text}, {"Prodotto", type text}, {"Column9", type any}, {"Prezzo unitario", type number}, {"Quantità", Int64.Type}}),
    #"Sostituito valore" = Table.ReplaceValue(#"Modificato tipo1",null,0,Replacer.ReplaceValue,{"Quantità"}),
    #"Duplicata colonna" = Table.DuplicateColumn(#"Sostituito valore", "COD PROD", "COD PROD - Copia"),
    #"Rimosse colonne" = Table.RemoveColumns(#"Duplicata colonna",{"COD PROD - Copia", "Column2", "Column3"}),
    #"Duplicata colonna1" = Table.DuplicateColumn(#"Rimosse colonne", "COD PROD", "COD PROD - Copia"),
    #"Riordinate colonne" = Table.ReorderColumns(#"Duplicata colonna1",{"COD PROD", "COD PROD - Copia", "Collaboratore", "Regione", "Column6", "Categoria", "Prodotto", "Column9", "Prezzo unitario", "Quantità"}),
    #"Rimosse colonne1" = Table.RemoveColumns(#"Riordinate colonne",{"COD PROD - Copia"}),
    #"Duplicata colonna2" = Table.DuplicateColumn(#"Rimosse colonne1", "COD PROD", "COD PROD - Copia"),
    #"Riordinate colonne1" = Table.ReorderColumns(#"Duplicata colonna2",{"COD PROD", "COD PROD - Copia", "Collaboratore", "Regione", "Column6", "Categoria", "Prodotto", "Column9", "Prezzo unitario", "Quantità"}),
    #"Rinominate colonne" = Table.RenameColumns(#"Riordinate colonne1",{{"Column6", "Data ordine"}}),
    #"Ordinate righe" = Table.Sort(#"Rinominate colonne",{{"Collaboratore", Order.Ascending}}),
    #"Suddividi colonna in base alle posizioni" = Table.SplitColumn(#"Ordinate righe", "COD PROD", Splitter.SplitTextByPositions({0, 2}), {"COD PROD.1", "COD PROD.2"}),
    #"Modificato tipo2" = Table.TransformColumnTypes(#"Suddividi colonna in base alle posizioni",{{"COD PROD.1", type text}, {"COD PROD.2", Int64.Type}}),
    #"Riordinate colonne2" = Table.ReorderColumns(#"Modificato tipo2",{"COD PROD.1", "COD PROD - Copia", "COD PROD.2", "Collaboratore", "Regione", "Data ordine", "Categoria", "Prodotto", "Column9", "Prezzo unitario", "Quantità"}),
    #"Rimosse colonne2" = Table.RemoveColumns(#"Riordinate colonne2",{"COD PROD.1"}),
    #"Rinominate colonne1" = Table.RenameColumns(#"Rimosse colonne2",{{"COD PROD - Copia", "COD PROD"}, {"COD PROD.2", "4 Cifre area"}}),
    #"Filtrate righe" = Table.SelectRows(#"Rinominate colonne1", each true),
    #"Rimosse colonne3" = Table.RemoveColumns(#"Filtrate righe",{"Column9"}),
    #"Aggiunta colonna personalizzata" = Table.AddColumn(#"Rimosse colonne3", "Personalizzato", each [Prezzo unitario]*[Quantità]),
    #"Rinominate colonne2" = Table.RenameColumns(#"Aggiunta colonna personalizzata",{{"Personalizzato", "TOTALE"}}),
    #"Aggiunta colonna personalizzata1" = Table.AddColumn(#"Rinominate colonne2", "IVA", each [TOTALE]*22/100),
    #"Aggiunta colonna personalizzata2" = Table.AddColumn(#"Aggiunta colonna personalizzata1", "CATPROD", each [Categoria]&[Prodotto]),
    #"Colonna condizionale aggiunta" = Table.AddColumn(#"Aggiunta colonna personalizzata2", "SE", each if [Quantità] > 20 then "TROVATO" else null),
    #"Colonna condizionale aggiunta1" = Table.AddColumn(#"Colonna condizionale aggiunta", "SECONDA", each if [Quantità] > 20 then "TROVATO" else null),
    #"Rimosse colonne4" = Table.RemoveColumns(#"Colonna condizionale aggiunta1",{"SECONDA", "SE"}),
    #"due passaggi" = Table.TransformColumns(#"Rimosse colonne4",{{"Regione", Text.Upper, type text}})
in
    #"due passaggi"